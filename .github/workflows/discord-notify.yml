name: Notify Discord on PR Opened

on:
    pull_request:
        types: [opened, reopened, synchronize, ready_for_review]

jobs:
    notify-discord:
        runs-on: ubuntu-latest

        steps:
            - name: Send PR info to Discord
              env:
                  DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
                  TITLE: ${{ github.event.pull_request.title }}
                  URL: ${{ github.event.pull_request.html_url }}
                  AUTHOR: ${{ github.event.pull_request.user.login }}
              run: |
                  TIMESTAMP=$(date -u +"%Y-%m-%d %H:%M:%S UTC")

                  curl -X POST "$DISCORD_WEBHOOK" \
                    -H "Content-Type: application/json" \
                    -d @- <<EOF
                  {
                    "content": "@everyone",
                    "embeds": [
                      {
                        "title": "ðŸ“¢ New Pull Request: ${TITLE}",
                        "url": "${URL}",
                        "description": "ðŸ‘¤ **Author**: [${AUTHOR}](https://github.com/${AUTHOR})",
                        "color": 3447003,
                        "author": {
                          "name": "${AUTHOR}",
                          "url": "https://github.com/${AUTHOR}",
                          "icon_url": "https://github.com/${AUTHOR}.png"
                        },
                        "footer": {
                          "text": "ðŸ•’ Opened at ${TIMESTAMP}"
                        }
                      }
                    ]
                  }
                  EOF
